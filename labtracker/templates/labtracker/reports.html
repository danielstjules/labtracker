{% extends 'base.html' %} 
{% block title %}labtracker | Generate Reports{% endblock %}
{% block h1_title %}<h1>Reports</h1>{% endblock %}

{% block content %}

{% if user.is_staff %}
	<h2>Generate Reports</h2>
	<form action="{{ req.get_post_comment_url }}" method="post" class="reports_form">
		{% csrf_token %}
		<p>
			Specify the range of dates used in building the Excel sheet. All 
			requests submitted within that range will be used in creating the file.
			That is, the requests' submission dates are looked at for determining 
			whether or not they're included. Feel free to use the shortcuts 
			we've provided, or specify the two dates individually. Furthermore, 
			by specifying a company or item, results will be filtered on those 
			criteria.
		</p>

		<div class="fl left_col">
			<strong>Specify two dates:</strong><br />
			<label for="startdate">Start date:</label>
			<input type="date" name="startdate"><br />
			<label for="enddate">End date:</label>
			<input type="date" name="enddate"><br />
		</div>

		<strong>Or select from a common range:</strong><br />
		<select name="timelength" id="timelength">
			<option value="alltime">All Time</option>
			<option value="past7days">Past 7 Days</option>
			<option value="past30days">Past 30 Days</option>
			<option value="past60days">Past 60 Days</option>
			<option value="past90days">Past 90 Days</option>
			<option value="past365days">Past 365 Days</option>
			<option value="thisweek">This Week</option>
			<option value="thismonth">This Month</option>
			<option value="thisyear">This Year</option>
		</select><br /><br />
		<div class="clear"></div>

		<strong>Apply other constraints if needed:</strong><br />
		<label for="company">Company:</label>
		<select name="company" id="company">
			<option class="selected" value="" selected="selected">Company Name</option>
			{% for company in company_list %}
				<option value="{{ company }}">{{ company }}</option>
			{% endfor %}
		</select><br />

		<label for="company">Item:</label>
		<select name="item" id="item">
			<option class="selected" value="" selected="selected">Item Name</option>
			{% for item in item_list %}
				<option value="{{item.pk}}">
					{{ item.local_num }} - {{ item.description }}
				</option>
			{% endfor %}
		</select><br />

		<strong>
			Enter a title for the report, to be displayed in the Excel sheet:
		</strong><br />
		<input name="title" id="title" type="text"><br />

		<strong>
			Enter a brief description of the report, only to be shown on this page:
		</strong><br />
		<textarea name="description" id="description" cols="100" rows="5"></textarea><br />
		<strong>And submit to generate:</strong><br />
		<input type="submit" value="Generate Report" />
	</form>
	<h2>All Reports</h2>
	{% if report_list %}
		<table id="report_list" summary="Report List">
		<thead>
			<tr>
				<th scope="col">Generated By</th>
				<th scope="col">On</th>
				<th scope="col">Description</th>
				<th scope="col"></th>
				<th scope="col"></th>
			</tr>
		</thead>
		<tbody>
		{% for report in report_list %}
				<tr>
					<td>{{ report.user }}</td>
					<td>{{ report.date_created }}</td>
					<td>{{ report.description }}</td>
					<td><a href="{{ MEDIA_URL }}{{ report.rfile }}">Download</a></td>
					<td><a href="{{ report.get_delete_url }}">Delete</a></td>
				</tr>
		{% endfor %}
		</tbody>
		</table>
	{% else %}
		<p>You have not generated any reports.</p>
	{% endif %}
{% else %}
	<p>You need to be an admin to view this page.</p>
{% endif %}

{% endblock %}
